#include <windows.h>
#include <iostream>
#include <conio.h>
#include <stdio.h>
#define ARRIBA 72
#define IZQUIERDA 75
#define DERECHA 77
#define ABAJO 80
#define ESC 27
#define ENTER 13

using namespace std;

int dir = 0;
int x=39,y=22;
int anteriorpx,anteriorpy;
char tecla;

long int puntos = 00;
int vidas = 1;

int color[0];

void muñeco(int x, int y)//ubicacion de pacman cor(x,y)
{
HANDLE hCon;//se encarga de
COORD dwPos;

dwPos.X = x;
dwPos.Y = y;
hCon = GetStdHandle(STD_OUTPUT_HANDLE);
SetConsoleCursorPosition(hCon,dwPos);
}

char mapa[50][100] = {
"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
"Y_AXXXXXB_AXB_AXXXXXXXXXXXXXB_AXB_AXXXXY",
"Y_DXXXXXC_Y Y_Y   DXXXXB AXXXXC_Y Y_DXXY",
"Y      Y Y______ -______Y  _________   Y",
"YXXXXXXX__Y DXXXXB_Y Y__XXXXC Y_AXXXXXXY",
"Y_Y AXXXXC_ XXXC_DXXXXB Y_Y __________XY",
"Y_Y Y_________________Y Y____      XXXXY",
"YXXXXXXXB_AXB_DXXXXXXXXXXXXXC_AXB_AXXXXY",
"Y_Y Y_________________Y Y_Y ___________Y",
"Y_Y  _AXXXXXXXXXXXXXB _________________Y",
"YXXXXXXC_DXC_DXXXXB AXXXXC_DXC_DXXXXXXXY",
"Y____    _______    _______    ________Y",
"YXXXXXB_AXXXXXXB_Y Y_AXXXXXXB_AXXXXXB__Y",
"Y_DXXXB Y_DXXXXXXC_DXXXC_DXXXXXXC_Y AXXY",
"Y_____Y Y_________|_____|_________Y Y__Y",
"YXXXB_Y Y_AXB_AXXXX--XXXXXXXB_AXB_Y Y_AY",
"YXXXC_DXC_ Y_DXXXXB AXXXXC_Y Y_DXC__XXXY",
"Y_________ Y______Y Y_______ __________Y",
"Y_AXX----XXC DXXXXB_Y Y_AXXXXC DXXXXXXXY",
"                                       _",

};

void pintar_mapa()//pinta borde pantalla
{
for(int i = 0 ; i < 78 ; i++){
for(int j = 0 ; j < 30 ; j++){
muñeco(i,j);

if(mapa[j][i] == 'X') {printf("%c",205);}
if(mapa[j][i] == ' ') {printf("%c",250);}//puntos
else if(mapa[j][i] == 'Y') {printf("%c",186);}
else if(mapa[j][i] == 'A') {printf("%c",201);}
else if(mapa[j][i] == 'B') {printf("%c",187);}
else if(mapa[j][i] == 'C') {printf("%c",188);}
else if(mapa[j][i] == 'D') {printf("%c",200);}



}
}
}

void pacman(int x , int y){
//setCColor(color[1]);
muñeco(x,y); printf("%c",2);//caracter assci(pacman)
}

void borrar_pacman(int x, int y){
muñeco(x,y); printf(" ");
if(mapa[y][x] == ' '){ mapa[y][x] = ' '; puntos += 5;}
}
void teclear(){
if(kbhit()){
tecla = getch();
switch(tecla){
case ARRIBA:
dir = 0;
break;

case ABAJO:
dir = 1;
break;

case DERECHA:
dir = 2;
break;

case IZQUIERDA:
dir = 3;
break;

}//end switch

}//end if

}

class fantasma{
int fdir;
int _x, _y;
int col;
public:
fantasma(int x , int y , int color);//constructor
void dibujar_fantasma() const;
void borrar_fantasma() const;
void mover_fantasma();
void choque_pacman();
};
fantasma::fantasma(int x , int y, int color){
_x = x;
_y = y;
col = color;
fdir = rand()%4;
}
void fantasma::dibujar_fantasma() const{

muñeco(_x,_y); printf("%c",6);//se dibuja el fantasma
}
void fantasma::borrar_fantasma() const{

muñeco(_x,_y); printf(" ");
}
void fantasma::choque_pacman(){
if(y == _y && x == _x || (fdir == 0 && dir == 1 || fdir == 1 && dir == 0
||fdir == 2 && dir == 3 || fdir == 3 && dir == 2 )&&(_y == anteriorpy && _x == anteriorpx)){


x = 39;//posiciones d pacman en el tablero
y = 22;
dir = 4;
vidas--;

}

}

void fantasma::mover_fantasma(){
borrar_fantasma();
choque_pacman();


if(fdir == 2){
if(mapa[_y][_x+1] != 'X' && mapa[_y][_x+1] != 'A'&& mapa[_y][_x+1] != 'Y'&&
mapa[_y][_x+1] != 'B'&& mapa[_y][_x+1] != 'C'&& mapa[_y][_x+1] != 'D') _x++;
else fdir = rand()%4;
}
if(fdir == 3){
if(mapa[_y][_x-1] != 'X' && mapa[_y][_x-1] != 'A' && mapa[_y][_x-1] != 'Y' &&
mapa[_y][_x-1] != 'B' && mapa[_y][_x-1] != 'C' && mapa[_y][_x-1] != 'D') _x--;
else fdir = rand()%4;
}
if(fdir == 0){
if(mapa[_y-1][_x] != 'X' && mapa[_y-1][_x] != 'A' && mapa[_y-1][_x] != 'Y' &&
mapa[_y-1][_x] != 'B' && mapa[_y-1][_x] != 'C' && mapa[_y-1][_x] != 'D') _y--;
else fdir = rand()%4;
}
if(fdir == 1){
if(mapa[_y+1][_x] != 'X' && mapa[_y+1][_x] != 'A' && mapa[_y+1][_x] != 'Y' &&
mapa[_y+1][_x] != 'B' && mapa[_y+1][_x] != 'C' && mapa[_y+1][_x] != 'D') _y++;
else fdir = rand()%4;
}


// rutina atajo movimientos de fantasmas
if(_x <= 0) _x = 61;
else if(_x >= 62) _x = 0;
dibujar_fantasma();
}


void marcador(){

muñeco(4,23); printf("PUNTOS");
muñeco(4,24); printf("%ld",puntos);//ubica el marcador en el tablero

muñeco(5,25); printf("VIDAS");//ubica el marcador en el tablero
for(int i = 1 ; i <= vidas ; i++){
muñeco(5,i+27);printf(" ");

}
for(int i = 0 ; i < vidas ; i++){
muñeco(5,i+27);printf("%c",2);//se dibija pacman

}

}

int main(){

fantasma A(38,10,0);
fantasma B(38,10,3);
fantasma C(37,10,4);
//fantasma D(39,14,5);
pintar_mapa();

while(vidas > 0 && puntos < 1950){
marcador();
borrar_pacman(x,y);
anteriorpx = x; anteriorpy = y;


teclear();

if(dir == 0 && mapa[y-1][x] != 'X' && mapa[y-1][x] != 'A' && mapa[y-1][x] != 'Y' &&
mapa[y-1][x] != 'B' && mapa[y-1][x] != 'C' && mapa[y-1][x] != 'D') y--;


else if(dir == 1 && mapa[y+1][x] != 'X' && mapa[y+1][x] != 'A' & mapa[y+1][x] != 'Y' &&
mapa[y+1][x] != 'B' && mapa[y+1][x] != 'C' && mapa[y+1][x] != 'D') y++;


pacman(x,y);
Sleep(99);//velocidad pacman
borrar_pacman(x,y);

B.choque_pacman();
C.choque_pacman();
//D.choque_pacman();
A.choque_pacman();

//A.mover_fantasma();
anteriorpx = x; anteriorpy = y;
teclear();

if(dir == 2 && mapa[y][x+1] != 'X' && mapa[y][x+1] != 'A' && mapa[y][x+1] != 'Y' &&
mapa[y][x+1] != 'B' && mapa[y][x+1] != 'C' && mapa[y][x+1] != 'D') x++;


else if(dir == 3 && mapa[y][x-1] != 'X}' && mapa[y][x-1] != 'A' && mapa[y][x-1] != 'Y' &&
mapa[y][x-1] != 'B' && mapa[y][x-1] != 'C' && mapa[y][x-1] != 'D') x--;

A.mover_fantasma();
B.mover_fantasma();
C.mover_fantasma();
//D.mover_fantasma();
pacman(x,y);
Sleep(100);
}
{
//for(int i = 0 ; i <= vidas ; i++){
//muñeco(5,i+27);printf(" ");

}

system("pause>NULL");
return 0;

}
